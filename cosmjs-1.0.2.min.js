osm=function(e){"use strict";var t,n="http://api.cosm.com/v2/",r="ws://api.cosm.com:8080/",i,s=false,o=function(e){if(typeof e==="function"){e.apply(this,Array.prototype.slice.call(arguments,1))}else if(Object.prototype.toString.apply(e)==="[object Array]"){var t=e.length;while(t--){e[t].apply(this,Array.prototype.slice.call(arguments,1))}}},u=function(e){if(window.console&&window.console.log){window.console.log(e)}},a=function(n){var r=e.extend({type:"get"},n);if(!t){return u("(cosmJS) ::: No API key ::: Set your API key first with cosm.setKey( YOUR_API_KEY ) before using any methods. Check docs for more info.")}if(!r.url){return}r.type=r.type.toUpperCase();if(r.type==="PUT"||r.type==="POST"){if(!r.data||typeof r.data!=="object"){return}else{r.data=JSON.stringify(r.data)}}e.ajax({url:r.url,type:r.type,headers:{"X-ApiKey":t},data:r.data,crossDomain:true,dataType:"json",cache:s}).done(r.done).fail(r.fail).always(r.always)},f={socket:false,socketReady:false,queue:[],resources:[]};f.connect=function(t){if(window.MozWebSocket){window.WebSocket=window.MozWebSocket}if(!f.socket&&window.WebSocket){f.socket=new WebSocket(r);f.socket.onerror=function(e){if(f.error){f.error(e,this)}f.connect()};f.socket.onclose=function(e){if(f.close){f.close(e,this)}f.connect()};f.socket.onopen=function(e){f.socketReady=true;if(f.open){f.open(e,this)}if(f.queue.length){o(f.queue)}if(t){t(this)}};f.socket.onmessage=function(t){var n=t.data,r=JSON.parse(n);if(r.body){e("body").trigger("cosm."+r.resource,r.body)}}}};f.subscribe=function(n,r){var i='{"headers":{"X-ApiKey":"'+t+'"}, "method":"subscribe", "resource":"'+n+'"}';if(!t){return u("(cosmJS) ::: No API key ::: Set your API key first with cosm.setKey( YOUR_API_KEY ) before using any methods. Check docs for more info.")}if(!f.resources[n]){f.resources.push(n);if(!f.socketReady){f.connect();f.queue.push(function(){f.socket.send(i)})}else{f.socket.send(i)}}if(r&&typeof r==="function"){e(document).on("cosm."+n,r)}};f.unsubscribe=function(e){var n='{"headers":{"X-ApiKey":"'+t+'"}, "method":"unsubscribe", "resource":"'+e+'"}';if(!t){return u("(cosmJS) ::: No API key ::: Set your API key first with cosm.setKey( YOUR_API_KEY ) before using any methods. Check docs for more info.")}if(f.socket){f.socket.send(n)}};e.ajaxSetup({cache:s});i={endpoint:n,setEndpoint:function(e){n=e},setWSEndpoint:function(e){r=e},setCache:function(t){if(t!==s){s=t;e.ajaxSetup({cache:s})}},setKey:function(e){t=e},request:function(e){a(e)},subscribe:function(e,t){f.subscribe(e,t)},unsubscribe:function(e){f.unsubscribe(e)},live:function(t,r){var i=function(n,i){var s=n.current_value?n:i;if(s.current_value){e(t).each(function(){e(this).html(s.current_value).attr("data-cosm-resource",r)})}};a({url:n+r.replace(/^\//,""),always:i});f.subscribe(r,i)},stop:function(t){f.unsubscribe(e(t).first().attr("data-cosm-resource"))},feed:{get:function(e,t){a({url:n+"feeds/"+e+".json",always:t})},update:function(e,t,r){a({type:"put",url:n+"feeds/"+e+".json",data:t,always:r})},"new":function(e,t){a({type:"post",url:n+"feeds",data:e,always:t})},"delete":function(e,t){a({type:"delete",url:n+"feeds/"+e,always:t})},history:function(e,t,r){a({url:n+"feeds/"+e+".json",data:t,always:r})},list:function(e,t){a({url:n+"feeds",data:e,always:t})},subscribe:function(e,t){if(e){f.subscribe("/feeds/"+e,t)}},unsubscribe:function(e,t){if(e){f.unsubscribe("/feeds/"+e)}}},datastream:{get:function(e,t,r){a({url:n+"feeds/"+e+"/datastreams/"+t+".json",always:r})},update:function(e,t,r,i){a({type:"put",url:n+"feeds/"+e+"/datastreams/"+t+".json",data:r,always:i})},"new":function(e,t,r){a({type:"post",url:n+"feeds/"+e+"/datastreams",data:t,always:r})},"delete":function(e,t,r){a({type:"delete",url:n+"feeds/"+e+"/datastreams/"+t,always:r})},history:function(e,t,r,i){a({url:n+"feeds/"+e+"/datastreams/"+t+".json",data:r,always:i})},list:function(e,t){a({url:n+"feeds/"+e+".json",always:function(e){t.call(this,e.datastreams)}})},subscribe:function(e,t,n){if(e&&t){f.subscribe("/feeds/"+e+"/datastreams/"+t,n)}},unsubscribe:function(e,t,n){if(e&&t){f.unsubscribe("/feeds/"+e+"/datastreams/"+t)}},live:function(e,t,n){if(e&&t&&n){i.live(e,"/feeds/"+t+"/datastreams/"+n)}},stop:function(e){if(e){i.stop(e)}}},datapoint:{get:function(e,t,r,i){a({url:n+"feeds/"+e+"/datastreams/"+t+"/datapoints/"+r,always:i})},update:function(e,t,r,i,s){a({type:"put",url:n+"feeds/"+e+"/datastreams/"+t+"/datapoints/"+r,data:{value:i},always:s})},"new":function(e,t,r,i){a({type:"post",url:n+"feeds/"+e+"/datastreams/"+t+"/datapoints",data:r,always:i})},"delete":function(e,t,r,i){var s={type:"delete",always:i};if(typeof r==="object"){s.url=n+"feeds/"+e+"/datastreams/"+t+"/datapoints";s.data=r}else{s.url=n+"feeds/"+e+"/datastreams/"+t+"/datapoints/"+r}a(s)},history:function(e,t,r,i){a({url:n+"feeds/"+e+"/datastreams/"+t+".json",data:r,always:function(e){i.call(this,e.datapoints)}})}}};return i}(jQuery);(function(e){"use strict";var t=function(e){if(typeof e==="object"){return"/feeds/"+e.feed+(e.datastream?"/datastreams/"+e.datastream:"")}else if(typeof e==="string"&&e!==""){return e}else{return""}},n={live:function(e){cosm.live(this,t(e));return this},get:function(n){var r=e(this);cosm.request({url:cosm.endpoint+t(n)+".json",always:function(t){r.each(function(){e(this).html(t.current_value)})}});return this}};e.fn.cosm=function(t){if(n[t]){return n[t].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof t==="object"||!t){return n.init.apply(this,arguments)}else{e.error("Method "+t+" does not exist on jQuery.tooltip")}}})(jQuery)
